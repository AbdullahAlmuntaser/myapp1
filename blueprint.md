# مخطط التطبيق (Blueprint)

## نظرة عامة على المشروع
هذا المشروع عبارة عن نظام لإدارة الطلاب يهدف إلى تبسيط العمليات المدرسية الأساسية المتعلقة بالطلاب والمعلمين والمواد الدراسية والصفوف والجداول والدرجات والحضور. يستخدم التطبيق إطار عمل Flutter لإتاحة الوصول على منصات متعددة، ويعتمد على مزودي (Providers) لإدارة الحالة ونماذج (Models) واضحة لتمثيل البيانات.

## الميزات الحالية

بناءً على تحليل ملفات المشروع، يتضمن التطبيق الميزات الأساسية التالية:

### 1. إدارة الكيانات الأساسية
*   **الطلاب (`Student`):** إضافة، تعديل، عرض الطلاب.
*   **المعلمون (`Teacher`):** إضافة، تعديل، عرض المعلمين.
*   **الصفوف (`Class`):** إضافة، تعديل، عرض الصفوف الدراسية.
*   **المواد الدراسية (`Subject`):** إضافة، تعديل، عرض المواد.
*   **الجداول الدراسية (`Timetable`):** إضافة، تعديل، عرض الجداول.
*   **الدرجات (`Grade`):** إضافة، تعديل، عرض درجات الطلاب (بما في ذلك شاشة إدخال الدرجات بالجملة ونظرة عامة).
*   **الحضور (`Attendance`):** تتبع وعرض حضور وغياب الطلاب.

### 2. إدارة الحالة
*   يتم استخدام حزمة `provider` لإدارة الحالة عبر التطبيق لمختلف الكيانات (الطلاب، المعلمون، الصفوف، إلخ).
*   يتضمن `ThemeProvider` لإدارة سمات التطبيق (الوضع الفاتح والداكن).

### 3. واجهة المستخدم والشاشات
*   **لوحة القيادة (`DashboardScreen`):** نقطة دخول مركزية.
*   **شاشات الإضافة والتعديل:** شاشات مخصصة لإضافة وتعديل بيانات كل من الصفوف، الدرجات (كحوار)، الطلاب، المواد، المعلمين، والجداول.
*   **شاشات العرض:** شاشات لعرض الحضور، الدرجات، والجداول الدراسية.
*   **الجدوال (Tabs) الرئيسية:**
    *   `StudentsTab`: إدارة الطلاب.
    *   `TeachersTab`: إدارة المعلمين.
    *   `ClassesTab`: إدارة الصفوف.
    *   `SubjectsTab`: إدارة المواد الدراسية.
    *   `GradesBulkEntryTab`: إدخال الدرجات بكميات كبيرة.
    *   `GradesOverviewTab`: نظرة عامة على الدرجات.
    *   `ReportsTab`: قسم للتقارير (يحتاج إلى توسيع).
    *   `SettingsTab`: إعدادات التطبيق (مثل معلومات "حول التطبيق").

### 4. قاعدة البيانات
*   يوجد `DatabaseHelper` مما يشير إلى استخدام قاعدة بيانات محلية (ربما SQLite) لإدارة البيانات.

### 5. الاختبارات
*   ملفات اختبارات موجودة لمزودي (providers) وشاشات معينة، مما يدل على بداية جيدة لجودة الكود.

## التغييرات الحالية (Current Changes)

تم معالجة المشكلات التالية لتحسين استقرار الكود وتقليل الأخطاء:

*   **`lib/screens/student_detail_for_parent_screen.dart`**:
    *   تم إصلاح مشكلة تكرار `trailing` widget في `ListView.builder` لقسم الحضور.
    *   تم تصحيح أخطاء في تهيئة `Text` widgets وسلسلة من الأخطاء النحوية الناتجة عن أخطاء النسخ واللصق في قسم الجدول الزمني.
    *   تم إزالة استيراد غير مستخدم لـ `teacher_provider.dart`.
    *   تم إضافة وتنفيذ طرق `getClassByClassIdString` في `ClassProvider` و`getSubjectById` في `SubjectProvider` و`DatabaseHelper` لدعم جلب البيانات اللازمة بشكل صحيح.
*   **`lib/screens/dashboard_screen.dart`**:
    *   تم إزالة الاستيرادات غير المستخدمة لـ `student_provider.dart`، `teacher_provider.dart`، `class_provider.dart`، و `subject_provider.dart`.
    *   تم إزالة الكلمة المفتاحية `await` من استدعاء `authService.signOut()` حيث أن الوظيفة ترجع `void`، مما أدى إلى حل خطأ `await_only_futures`.
*   **`lib/screens/add_edit_student_screen.dart`**:
    *   تم تصحيح مشكلات `prefer_interpolation_to_compose_strings` باستخدام الاستيفاء الصحيح للسلاسل.
*   **`lib/screens/register_screen.dart`**:
    *   تم حل تحذيرات `use_build_context_synchronously` عن طريق إضافة فحص `if (!mounted) return;` قبل استخدام `BuildContext` بعد عمليات `await` غير متزامنة.

هذه الإصلاحات تضمن أن التطبيق أصبح أكثر استقرارًا وخالياً من الأخطاء التي تم تحليلها مؤخرًا.

## خطة التحسينات والتطوير

تهدف هذه الخطة إلى تحسين تجربة المستخدم وتوسيع وظائف نظام إدارة المدرسة ليصبح حلاً شاملاً.

### 1. تحسينات الواجهة وتجربة المستخدم (UI/UX)

*   **تطبيق Material Design 3 المتكامل:**
    *   **الألوان:** استخدام `ColorScheme.fromSeed` لإنشاء لوحة ألوان متناسقة، وتطبيقها بشكل منهجي على جميع المكونات.
    *   **الخطوط (Typography):** دمج `google_fonts` لتحديد خطوط مخصصة وواضحة، مع تطبيق `TextTheme` لضمان اتساق أنماط النصوص (مثل `displayLarge`, `titleMedium`, `bodySmall`).
    *   **تخصيص المكونات:** استخدام `ThemeData` لتخصيص مظهر الأزرار (`ElevatedButtonThemeData`)، أشرطة التطبيق (`AppBarTheme`)، وغيرها من مكونات Material لإنشاء هوية بصرية فريدة.
    *   **الأيقونات والصور:** استخدام أيقونات معبرة وصور ذات صلة (مع توفير صور مؤقتة إذا لزم الأمر).
*   **الاستجابة والتكيف (Responsiveness):**
    *   تكييف تخطيطات الشاشات المختلفة (خاصة لوحات القيادة والجداول) لتبدو جيدة على أحجام الشاشات المختلفة (الهواتف المحمولة، الأجهزة اللوحية، الويب).
    *   استخدام `MediaQuery` و `LayoutBuilder` لتصميم واجهات مرنة.
*   **الحركات الانتقالية والجاذبية:**
    *   إضافة حركات انتقالية مخصصة بين الشاشات لتحسين التجربة البصرية.
    *   إضافة تأثيرات بصرية دقيقة (مثل الظلال، التوهج عند التفاعل) على الأزرار والعناصر التفاعلية.
*   **التعامل مع حالات خاصة:**
    *   توفير مؤشرات تحميل واضحة (`CircularProgressIndicator`) عند جلب البيانات.
    *   عرض رسائل واجهات جذابة عند عدم وجود بيانات (empty states).
*   **تحسين النماذج والمدخلات:**
    *   توفير تحقق فوري وواضح من صحة المدخلات في جميع النماذج.
    *   تقديم رسائل خطأ ودية ومفيدة للمستخدم.
*   **الوصولية (Accessibility):**
    *   ضمان أن التطبيق قابل للاستخدام من قبل مجموعة واسعة من المستخدمين ذوي الاحتياجات المختلفة (مثل دعم قارئات الشاشة، أحجام الخطوط القابلة للتعديل، تباين الألوان الجيد).

### 2. توسيع ميزات نظام إدارة المدرسة

#### المرحلة الأولى: إضافات أساسية (ذات أولوية عالية)

1.  **المصادقة وإدارة المستخدمين (Authentication & User Management):**
    *   **شاشات تسجيل الدخول والخروج:** تنفيذ نظام تسجيل دخول آمن (يمكن استخدام Firebase Authentication لاحقاً).
    *   **الأدوار والصلاحيات:** تحديد أدوار المستخدمين (إداري، معلم، طالب) وتطبيق نظام صلاحيات صارم للتحكم في الوصول إلى الميزات والبيانات.
    *   **شاشة إنشاء حساب إداري:** لإعداد المستخدم الإداري الأولي.
2.  **بوابة أولياء الأمور (Parent Portal):**
    *   واجهة بسيطة تسمح لأولياء الأمور بتسجيل الدخول وعرض معلومات أبنائهم (الحضور، الدرجات، الجدول الدراسي، الإعلانات).
3.  **نظام الإعلانات والإشعارات (Announcements & Notifications):**
    *   نظام يسمح للمسؤولين والمعلمين بنشر إعلانات عامة أو خاصة بصفوف محددة.
    *   عرض الإعلانات على لوحة القيادة أو في قسم خاص.

#### المرحلة الثانية: ميزات متقدمة (ذات أولوية متوسطة)

1.  **إدارة الرسوم الدراسية (Fee Management):**
    *   **هياكل الرسوم:** تحديد أنواع الرسوم المختلفة (رسوم دراسية، مواصلات، أنشطة).
    *   **تتبع الدفعات:** تسجيل دفعات الرسوم وتتبع الرسوم المستحقة والمتأخرة لكل طالب.
    *   **تقارير الرسوم:** إنشاء تقارير عن حالة الرسوم.
2.  **إدارة الامتحانات والنتائج (Exam & Result Management):**
    *   **جدولة الامتحانات:** القدرة على تحديد مواعيد الامتحانات وإنشائها.
    *   **إدخال الدرجات:** واجهة مبسطة للمعلمين لإدخال درجات الامتحانات.
    *   **إصدار الشهادات/بطاقات النتائج:** إنشاء تقارير نتائج للطلاب.
3.  **الموارد التعليمية والمكتبة الرقمية (Educational Resources):**
    *   **رفع الملفات:** السماح للمعلمين برفع مواد دراسية (مستندات، عروض تقديمية، فيديوهات) وربطها بالمواد أو الصفوف.
    *   **الوصول للطلاب:** تمكين الطلاب من الوصول إلى هذه الموارد وعرضها.

#### المرحلة الثالثة: ميزات شاملة (على المدى الطويل)

1.  **تقارير وتحليلات متقدمة (Advanced Reporting & Analytics):**
    *   تقارير مفصلة عن أداء الطلاب، اتجاهات الحضور والغياب، تحليل أداء المواد.
    *   إمكانية تخصيص التقارير بناءً على معايير مختلفة.
2.  **إدارة القبول والتسجيل (Admission Management):**
    *   نماذج طلبات الالتحاق عبر الإنترنت.
    *   تتبع حالة طلبات الالتحاق وعملية التسجيل.
3.  **نظام المراسلة الداخلية (In-app Messaging):**
    *   سماح بالاتصال المباشر بين المعلمين والطلاب، والمعلمين وأولياء الأمور داخل التطبيق.

---
**الخطة الحالية لمعالجة أخطاء البناء:**

1.  قراءة ملف `lib/main.dart` لتحديد المشكلة.
2.  إصلاح مشكلة الحرف غير ASCII في `lib/main.dart` عند السطر 46، العمود 51.
3.  تنظيف مشروع Flutter باستخدام `flutter clean`.
4.  جلب التبعيات باستخدام `flutter pub get`.
5.  تشغيل التطبيق مرة أخرى للتحقق مما إذا تم حل المشكلة.
